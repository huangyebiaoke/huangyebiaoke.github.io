---
title: ajax异步加载
date: 2018-06-02 17:17:18
tags:
  - ajax
  - json
---
![p12-1](/assets/blogimg/p12-1.png "p12-1")
<!--more-->
[TOC]
### 背景
	ajax即Asynchronous Javascript And XML,异步javascript和XML;json即JavaScript Object Notation,javascript对象标记.
### 使用原生js创建XMLHttpRequest对象

```
var xhr = new XMLHttpRequest;
xhr.open("GET", "https://blog.madeai.cn/api");
xhr.onload = function () {
    var data = JSON.parse(xhr.responseText);
    doSomething(data);
}
xhr.send();
```
1. 其中`xhr.open();`有3个传入参数,第一个是数据传输的方式,最常用的就是`post`,`get`了.第二个是后端的URL,值得注意的是如果是**跨域**的话,需要在后端PHP代码前添加`header("Access-Control-Allow-Origin: *");`,或者用代理.
第三参数是Boolean型的可选项,表示是否异步加载;
2. `xhr.onload();`是在数据加载完成后要处理的事情;也可以用`xhr.onreadystatechange=doSomething;`.
>onreadystatechange 是一个事件句柄。它的值 (state_Change) 是一个函数的名称，当 XMLHttpRequest 对象的状态发生改变时，会触发此函数。状态从 0 (uninitialized) 到 4 (complete) 进行变化。仅在状态为 4 时，我们才执行代码。
3. 最后一个`xhr.send();`就是将请求发送到服务器端了;

### 使用jquery封装的$ajax()和$getJSON()函数
- $ajax比较灵活哦,异步加载任何格式的数据;
```
$.ajax({
    type: "POST",//像登陆一样的比较重要的数据要用post,放进请求体里哦;
    url: "http://madeai.cn/api",
    dataType: "json",
    data: {
        username:444,
        password:6666//用md5签名,数据传输更安全;
    },
    success: function (obj) {
		doSomething(obj);
    },
    error: function(XMLHttpRequest, textStatus, errorThrown) {
        console.log(XMLHttpRequest.status,XMLHttpRequest.status,textStatus);
    },
```
- 用$getJSON()来获取json数据;
```
$.getJSON("http://madeai.cn/api", "", function (data) {
    $.each(data["result"].tracks, function (i, item) {//each循环 使用$.each方法遍历返回的数据data
	/*doSomething;
	 *function();中第一个参数是数组的索引index,第二个是原数组对象;
	 */
    });
});
```
---
demo click <a href="http://blog.madeai.cn/itme/example/ajax&json.html">here</a>


